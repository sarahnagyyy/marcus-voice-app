<!DOCTYPE html>
<html>
<head>
  <title>Marcus Aurelius</title>
</head>
<body>
  <h1>Welcome to Marcus Aurelius</h1>
  <p>Ask your question aloud when ready...</p>
  <button onclick="startRecording()">ğŸ™ï¸ Start Speaking</button>
  <p id="transcript"></p>
  <p id="response"></p>

   <audio id="marcus-audio" controls style="display:none;"></audio>

  <script>
  let mediaRecorder;
  let audioChunks = [];

  async function startRecording() {
    document.getElementById("transcript").textContent = "ğŸ™ï¸ Listening...";
    document.getElementById("response").textContent = "";
    document.getElementById("marcus-audio").style.display = "none";

    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);

    mediaRecorder.ondataavailable = event => {
      audioChunks.push(event.data);
    };

    mediaRecorder.onstop = async () => {
      const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
      audioChunks = [];

      const formData = new FormData();
      formData.append("file", audioBlob, "audio.wav");

      const res = await fetch("/transcribe/", {
        method: "POST",
        body: formData
      });

      const data = await res.json();

      document.getElementById("transcript").textContent = "ğŸ“ Transcript: " + data.transcript;
      document.getElementById("response").textContent = "ğŸ§  Marcus says: " + data.response;

      // Set audio source and play
      const audioPlayer = document.getElementById("marcus-audio");
      audioPlayer.src = data.audio_url;
      audioPlayer.style.display = "block";
      audioPlayer.play();
    };

    mediaRecorder.start();

    // Stop recording after 5 seconds
    setTimeout(() => {
      mediaRecorder.stop();
    }, 5000);
  }
</script>
</body>
</html>
